<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
	<select id="countAll" resultType="int" >
		select count(*) from product_info
	</select>
	<select id="getproduct" resultType="productvo">
		select * from product_info
	</select>
	<select id="getproductinfo" parameterType="String" resultType="productvo">
		SELECT INFO.PR_CODE,INFO.PR_NAME,INFO.PR_IMG,INFO.PR_BKIND, BCATE.VALUE AS PR_BKIND_VALUE,
		info.PR_SKIND, SCATE.VALUE AS PR_SKIND_VALUE,
		info.PR_COUNTRY,info.PR_CITY,info.PR_ALCOHOL,info.PR_PLACE,info.PR_FOOD,
		info.PR_CONTENT,info.PR_PRICE,info.PR_AMOUNT,info.PR_TOTALCOUNT,info.PR_LIKE,
		info.PR_USE,info.INSERT_ID,info.INSERT_DAY
		FROM PRODUCT_INFO INFO INNER JOIN
			DRINK_CATEGORY BCATE ON info.PR_BKIND = BCATE.CODE INNER JOIN
			DRINK_CATEGORY SCATE ON info.PR_SKIND = SCATE.CODE 
		WHERE PR_CODE = #{value}
	</select>
	<select id="myordercount" parameterType="string" resultType="int">
		select count(*) from order_info where user_id = #{value}
	</select>
	<select id="myorderlist" parameterType="string" resultType="ordervo">
		select * from order_info where user_id = #{value}
	</select>
	<insert id="insertorder" parameterType="ordervo">
		INSERT INTO ORDER_INFO(or_code,or_day,or_seq,pr_code,pr_name,or_status,pr_price,pr_count,user_id,RECEIVER_NAME ,RECEIVER_TEL ,RECEIVER_ADDR ,INSERT_DAY )
		values(#{orCode},(SELECT TO_CHAR(SYSDATE,'YYYYMMDD') FROM DUAL),#{orSeq},#{prCode},#{prName},1,#{prPrice},#{prCount},#{userId},#{receiverName},#{receiverTel},#{receiverAddr},sysdate)
	</insert>
	<select id="sql" resultType="hashmap">
		SELECT 'O' ||(SELECT TO_CHAR(SYSDATE,'YYYYMMDD') FROM DUAL)|| ORDER_INFO_seq.nextval ,ORDER_INFO_seq.nextval FROM DUAL
	</select>
	<select id="orderinfo" parameterType="string" resultType="ordervo">
		select * from order_info where or_code = #{value}
	</select>
	
	<select id="orderlist" parameterType="map" resultType="ordervo">
		<![CDATA[
		select a.* from
			(select aa.* , rownum r from
				(SELECT OINFO.OR_CODE , OINFO.PR_CODE,OINFO.PR_NAME,OINFO.OR_STATUS,OINFO.PR_PRICE,OINFO.PR_COUNT,
				OINFO.USER_ID, OINFO.RECEIVER_NAME,OINFO.RECEIVER_TEL,oinfo.INSERT_DAY 
				FROM ORDER_INFO OINFO JOIN
				PRODUCT_INFO INFO ON INFO.PR_CODE = OINFO.PR_CODE 
				WHERE INFO.INSERT_ID = #{id} order by OINFO.INSERT_DAY asc)
			aa )
			a where r >= #{startrow} and r <= #{endrow} 
		
		]]>
	</select>
	
	<select id="selcount" parameterType="string" resultType="int">
		SELECT count(*)
			FROM ORDER_INFO OINFO JOIN
			PRODUCT_INFO INFO ON INFO.PR_CODE = OINFO.PR_CODE 
			WHERE INFO.INSERT_ID =#{value}
	</select>
	
	<select id="schcountAll" parameterType="map" resultType="int">
		select count(*) from product_info
			<trim prefix="where" prefixOverrides="and">
				<if test="skind !=null">
					AND pr_skind = #{skind}
				</if> 
				<if test="name !=null">
					AND pr_name like '%' || #{name} || '%'
				</if> 
				<if test="strprice != null">
  					<![CDATA[
  						AND pr_price >= #{strprice} 
  					 ]]>
  				</if>
  				<if test="endprice != null">
					<![CDATA[
  						AND pr_price <= #{endprice} 
  					 ]]>  				
  				</if>
  				<if test="stral != null">
  					<![CDATA[
  						AND pr_alcohol >= #{stral} 
  					 ]]>
  				</if>
  				<if test="endal != null">
					<![CDATA[
  						AND pr_alcohol <= #{endal} 
  					 ]]>  				
  				</if>
			</trim>
	</select>
	
	<select id="schgetproduct" parameterType="map" resultType="productvo">
		select * from product_info
			<trim prefix="where" prefixOverrides="and">
				<if test="skind !=null">
					AND pr_skind = #{skind}
				</if> 
				<if test="name !=null">
					AND pr_name like '%' || #{name} || '%'
				</if> 
				<if test="strprice != null">
  					<![CDATA[
  						AND pr_price >= #{strprice} 
  					 ]]>
  				</if>
  				<if test="endprice != null">
					<![CDATA[
  						AND pr_price <= #{endprice} 
  					 ]]>  				
  				</if>
  				<if test="stral != null">
  					<![CDATA[
  						AND pr_alcohol >= #{stral} 
  					 ]]>
  				</if>
  				<if test="endal != null">
					<![CDATA[
  						AND pr_alcohol <= #{endal} 
  					 ]]>  				
  				</if>
			</trim>
	</select>

</mapper>
